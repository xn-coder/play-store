<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body data-page="login">
    <div th:fragment="content">
        <form id="login-form">
            <h2>Login</h2>
            <div>
                <label for="username">Username</label>
                <input type="text" id="username" required>
            </div>
            <div>
                <label for="password">Password</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit">Login</button>
        </form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            updateNav();
            setupLoginForm();
        });

        function setupLoginForm() {
            const loginForm = document.getElementById('login-form');
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                const users = JSON.parse(localStorage.getItem('users')) || [];
                const user = users.find(u => u.username === username && u.password === password);

                if (user) {
                    localStorage.setItem('loggedInUser', JSON.stringify(user));
                    alert('Login successful!');
                    if (user.role === 'owner') {
                        window.location.href = '/owner-dashboard';
                    } else {
                        window.location.href = '/';
                    }
                } else {
                    alert('Invalid credentials!');
                }
            });
        }

        function isLoggedIn() {
            return !!localStorage.getItem('loggedInUser');
        }

        function updateNav() {
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            const navAuth = document.querySelector('.nav-auth');

            if (loggedInUser) {
                navAuth.innerHTML = `
                    ${loggedInUser.role === 'owner' ? '<li><a href="/owner-dashboard">Dashboard</a></li>' : ''}
                    <li><a href="#" id="logout-btn">Logout</a></li>
                `;
                 const logoutBtn = document.getElementById('logout-btn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => {
                        localStorage.removeItem('loggedInUser');
                        updateNav();
                        window.location.href = '/login';
                    });
                }
            } else {
                navAuth.innerHTML = `
                    <li><a href="/login" class="active">Login</a></li>
                    <li><a href="/register">Register</a></li>
                `;
            }
        }
    </script>
</body>
</html>